// ==UserScript==
// @name         One-Click Edit (Optimized)
// @version      2.0
// @description  Click your message to instantly start editing it in Discord (Vencord)
// @author       sailentcoder
// ==/UserScript==

const { React, WebpackModules } = vendord; // Vencord internal modules

module.exports = class OneClickEditOptimized {
    start() {
        // Patch message component render
        const Message = WebpackModules.getModule(m => m?.default?.displayName === 'Message');
        this.cancelPatch = vendord.Patcher.after(Message, 'default', (_, [props], ret) => {
            const isYourMessage = props.message.author.id === vendord.UserStore.getCurrentUser().id;
            if (!isYourMessage) return ret;

            // Add click handler to root element
            const originalOnClick = props.onClick;
            props.onClick = (e) => {
                if (['A', 'BUTTON', 'INPUT', 'TEXTAREA'].includes(e.target.tagName)) {
                    originalOnClick?.(e);
                    return;
                }
                const editButton = document.querySelector(`[aria-label="Edit"][data-message-id="${props.message.id}"]`);
                if (editButton) editButton.click();
                originalOnClick?.(e);
            };
            return ret;
        });
    }

    stop() {
        if (this.cancelPatch) this.cancelPatch();
    }
};
